(function(){this.Blue=this.Blue||{},this.Blue.version=this.Blue.version||{},this.Blue.buildDate=this.Blue.buildDate||{},this.Blue.buildHash=this.Blue.buildHash||{},this.Blue.version["blue-view/main"]="2.24.1",this.Blue.buildDate["blue-view/main"]="2021-08-05T17:43:17.827Z",this.Blue.buildHash["blue-view/main"]="72891df"}).call(this),requirejs.config({paths:{d3:"d3/dist/d3","xss-filters":"xss-filters/dist/xss-filters.min"},shim:{"xss-filters":{exports:"xssFilters"}}}),define("blue-view/config",(function(){})),function(e,t){function n(e,t,n){return i.yubl(t((n||i.yufull)(e)))}e._getPrivFilters=function(){function e(e){var t=e.split(A,2);return!t[0]||2!==t.length&&e.length===t[0].length?null:t[0]}function t(e,t,n,i){return t=t||f,n=n||v,void 0===e?"undefined":null===e?"null":e.toString().replace(l,"�").replace(n,(function(e,n,r,a){return n?(n=Number(n[0]<="9"?n:"0"+n),i?I(n):128===n?"€":130===n?"‚":131===n?"ƒ":132===n?"„":133===n?"…":134===n?"†":135===n?"‡":136===n?"ˆ":137===n?"‰":138===n?"Š":139===n?"‹":140===n?"Œ":142===n?"Ž":145===n?"‘":146===n?"’":147===n?"“":148===n?"”":149===n?"•":150===n?"–":151===n?"—":152===n?"˜":153===n?"™":154===n?"š":155===n?"›":156===n?"œ":158===n?"ž":159===n?"Ÿ":n>=55296&&n<=57343||13===n?"�":o.frCoPt(n)):t[r||a]||e}))}function n(e){return"\\"+e.charCodeAt(0).toString(16).toLowerCase()+" "}function i(e){return e.replace(w,(function(e){return"-x-"+e}))}function r(n){var i=e(n=o.yufull(t(n)));return i&&C[i.toLowerCase()]?"##"+n:n}var o,a=/</g,u=/"/g,s=/'/g,c=/&/g,l=/\x00/g,d=/(?:^$|[\x00\x09-\x0D "'`=<>])/g,p=/[&<>"'`]/g,m=/(?:\x00|^-*!?>|--!?>|--?!?$|\]>|\]$)/g,v=/&(?:#([xX][0-9A-Fa-f]+|\d+);?|(Tab|NewLine|colon|semi|lpar|rpar|apos|sol|comma|excl|ast|midast|ensp|emsp|thinsp);|(nbsp|amp|AMP|lt|LT|gt|GT|quot|QUOT);?)/g,f={Tab:"\t",NewLine:"\n",colon:":",semi:";",lpar:"(",rpar:")",apos:"'",sol:"/",comma:",",excl:"!",ast:"*",midast:"*",ensp:" ",emsp:" ",thinsp:" ",nbsp:" ",amp:"&",lt:"<",gt:">",quot:'"',QUOT:'"'},h=/^(?:(?!-*expression)#?[-\w]+|[+-]?(?:\d+|\d*\.\d+)(?:r?em|ex|ch|cm|mm|in|px|pt|pc|%|vh|vw|vmin|vmax)?|!important|)$/i,g=/[\x00-\x1F\x7F\[\]{}\\"]/g,b=/[\x00-\x1F\x7F\[\]{}\\']/g,w=/url[\(\u207D\u208D]+/g,y=/['\(\)]/g,x=/\/\/%5[Bb]([A-Fa-f0-9:]+)%5[Dd]/,C={javascript:1,data:1,vbscript:1,mhtml:1,"x-schema":1},A=/(?::|&#[xX]0*3[aA];?|&#0*58;?|&colon;)/,V=/(?:^[\x00-\x20]+|[\t\n\r\x00]+)/g,k={Tab:"\t",NewLine:"\n"},S=function(e,t,n){return void 0===e?"undefined":null===e?"null":e.toString().replace(t,n)},I=String.fromCodePoint||function(e){return 0===arguments.length?"":e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),e%1024+56320))};return o={frCoPt:function(e){return null==e?"":!isFinite(e=Number(e))||e<=0||e>1114111||e>=1&&e<=8||e>=14&&e<=31||e>=127&&e<=159||e>=64976&&e<=65007||11===e||65535==(65535&e)||65534==(65535&e)?"�":I(e)},d:t,yup:function(n){return(n=e(n.replace(l,"")))?t(n,k,null,!0).replace(V,"").toLowerCase():null},y:function(e){return S(e,p,(function(e){return"&"===e?"&amp;":"<"===e?"&lt;":">"===e?"&gt;":'"'===e?"&quot;":"'"===e?"&#39;":"&#96;"}))},ya:function(e){return S(e,c,"&amp;")},yd:function(e){return S(e,a,"&lt;")},yc:function(e){return S(e,m,(function(e){return"\0"===e?"�":"--!"===e||"--"===e||"-"===e||"]"===e?e+" ":e.slice(0,-1)+" >"}))},yavd:function(e){return S(e,u,"&quot;")},yavs:function(e){return S(e,s,"&#39;")},yavu:function(e){return S(e,d,(function(e){return"\t"===e?"&#9;":"\n"===e?"&#10;":"\v"===e?"&#11;":"\f"===e?"&#12;":"\r"===e?"&#13;":" "===e?"&#32;":"="===e?"&#61;":"<"===e?"&lt;":">"===e?"&gt;":'"'===e?"&quot;":"'"===e?"&#39;":"`"===e?"&#96;":"�"}))},yu:encodeURI,yuc:encodeURIComponent,yubl:function(e){return C[o.yup(e)]?"x-"+e:e},yufull:function(e){return o.yu(e).replace(x,(function(e,t){return"//["+t+"]"}))},yublf:function(e){return o.yubl(o.yufull(e))},yceu:function(e){return e=t(e),h.test(e)?e:";-x:'"+i(e.replace(b,n))+"';-v:"},yced:function(e){return i(t(e).replace(g,n))},yces:function(e){return i(t(e).replace(b,n))},yceuu:function(e){return r(e).replace(y,(function(e){return"'"===e?"\\27 ":"("===e?"%28":"%29"}))},yceud:function(e){return r(e)},yceus:function(e){return r(e).replace(s,"\\27 ")}}};var i=e._privFilters=e._getPrivFilters();e.inHTMLData=i.yd,e.inHTMLComment=i.yc,e.inSingleQuotedAttr=i.yavs,e.inDoubleQuotedAttr=i.yavd,e.inUnQuotedAttr=i.yavu,e.uriInSingleQuotedAttr=function(e){return n(e,i.yavs)},e.uriInDoubleQuotedAttr=function(e){return n(e,i.yavd)},e.uriInUnQuotedAttr=function(e){return n(e,i.yavu)},e.uriInHTMLData=i.yufull,e.uriInHTMLComment=function(e){return i.yc(i.yufull(e))},e.uriPathInSingleQuotedAttr=function(e){return n(e,i.yavs,i.yu)},e.uriPathInDoubleQuotedAttr=function(e){return n(e,i.yavd,i.yu)},e.uriPathInUnQuotedAttr=function(e){return n(e,i.yavu,i.yu)},e.uriPathInHTMLData=i.yu,e.uriPathInHTMLComment=function(e){return i.yc(i.yu(e))},e.uriQueryInSingleQuotedAttr=e.uriPathInSingleQuotedAttr,e.uriQueryInDoubleQuotedAttr=e.uriPathInDoubleQuotedAttr,e.uriQueryInUnQuotedAttr=e.uriPathInUnQuotedAttr,e.uriQueryInHTMLData=e.uriPathInHTMLData,e.uriQueryInHTMLComment=e.uriPathInHTMLComment,e.uriComponentInSingleQuotedAttr=function(e){return i.yavs(i.yuc(e))},e.uriComponentInDoubleQuotedAttr=function(e){return i.yavd(i.yuc(e))},e.uriComponentInUnQuotedAttr=function(e){return i.yavu(i.yuc(e))},e.uriComponentInHTMLData=i.yuc,e.uriComponentInHTMLComment=function(e){return i.yc(i.yuc(e))},e.uriFragmentInSingleQuotedAttr=function(e){return i.yubl(i.yavs(i.yuc(e)))},e.uriFragmentInDoubleQuotedAttr=function(e){return i.yubl(i.yavd(i.yuc(e)))},e.uriFragmentInUnQuotedAttr=function(e){return i.yubl(i.yavu(i.yuc(e)))},e.uriFragmentInHTMLData=e.uriComponentInHTMLData,e.uriFragmentInHTMLComment=e.uriComponentInHTMLComment,t.xssFilters=e}({},function(){return this}()),define("xss-filters",function(e){return function(){return e.xssFilters}}(this)),define("blue-view/resolver/cav",["require","blue/as/serializable","blue/is","blue/object/extend","blue/util","blue/deferred","blue/log"],(function(e){"use strict";var t=e("blue/as/serializable"),n=e("blue/is"),i=e("blue/object/extend"),r=e("blue/util").object.deepClone,o=e("blue/deferred"),a=e("blue/log")("[blue:view]"),u={append:!1,react:!1},s=0;function c(e,t,a,s,c,l){var d=n.array(s)?s[0]:s.component,p=n.array(s)?s[1]:s.view,m=n.array(s)?s[2]||{}:s.options,v=l?r(l):e.viewResolverOptions||{};this.hasComponent=!d,this.hasView=!1,this.view=void 0,this.component=void 0,this.viewName=void 0,this.options=i({},u,m||{}),this.resolving=new o,this.resolved=this.resolving.promise,d&&this.setComponent(e,d,p),this.viewEngine=t,n.string(p)&&"/"!==p[0]&&d&&d.context?d.context.page&&d.context.page.viewResolverOptions&&(v=r(d.context.page.viewResolverOptions)):n.string(p)&&"/"===p[0]&&(p=p.substr(1),v={}),p&&this.setView(e,a,p,c,v)}return c.prototype.resolve=function(){var e;if(this.isReady()){if(this.component&&this.view.viewName&&!this.component._("viewName")&&this.component._("viewName",this.view.viewName),!this.viewInternals.bridge){var t=this.component&&this.component.key?this.component.key:"EMPTY";this.viewInternals.createBridge({name:t,bindings:{},triggers:{}})}this.component&&(e=this.component.spec||{},this.viewInternals.bridge.addComponentSpecData(Object.keys(e.data||{}).reduce((function(e,t){return e[t]=1,e}),{})),this.viewInternals.bridge.addComponentSpecSettings(this.component.getSettingsValues()),this.viewInternals.bridge.addComponentSpecActions(this.component.getActionNames()),this.view._componentStack=this.component.context.getStack()),this.component&&this.component.context&&(this.view.htmlAttrs["data-component-name"]=this.component.context.parent.getStack()+"|"+(this.component.key||this.component.context.name)+"|"+this.component.spec.name),this.options.viewInternals=this.viewInternals,this.resolving.resolve([this.component,this.view,this.options])}},c.prototype.reject=function(e,t){t.msg=t.message,a.error("["+e.getStack()+"]","CAV failed to resolve:",t),e.page.emit("page:error",{code:"blue:cav:error:cavResolutionFailed",description:"CAV could not be resolved:"+t}),this.resolving.reject(t)},c.prototype.setComponent=function(e,t,i){var r=this;t.oldComponent?(t.oldComponent.then((function(){r.component=t,r.component._("viewName",n.string(i)?i:""),r.hasComponent=!0,r.resolve()})).catch((function(o){o.msg=o.message,a.warn("["+e.getStack()+"]","Old Component instance "+t.key+" failed to destroy cleanly",o),r.component=t,r.component._("viewName",n.string(i)?i:""),r.hasComponent=!0,a.error("["+e.getStack()+"]","CAV component "+t.key+" failed to remove old component with same name:",o),e.page.emit("page:error",{code:"blue:cav:error:componentConstructionFailed",description:"CAV component "+t.key+" failed to remove old component with same name:"+o}),r.reject(e,o)})),delete t.oldComponent):(r.component=t,r.component._("viewName",n.string(i)?i:""),r.hasComponent=!0,r.resolve())},c.prototype.setView=function(e,t,i,r,o){var u,c,l,d=this,p=o.prefix||"",m=o.suffix||"";o=o||{},n.string(i)?(this.viewName=i,t[u=r+"/"+i]?(c=t[u],o={},l=e.getViewRegistry(d.viewEngine)):(c=p+i+m,l=e.getViewRegistry(d.viewEngine)),u=u+"/"+s,l.then((function(t){n.string(c)?t.registerView(u,e.viewResolver.createId(c,o),!0):t.registerView(u,c,!0)}))):(this.viewName=i.name||i.viewName||"anonymous",u=p+this.viewName+m,(l=e.getViewRegistry(d.viewEngine)).then((function(e){e.registerView(u,i,!0)}))),n.object(this.options)&&n.defined(i.targetSelector)&&!n.defined(this.options.target)&&(this.options.target=i.targetSelector),l.then((function(t){t.getView(u).then((function(t){t&&n.function(t.replaceIn)&&n.function(t.appendTo)?(d.view=t,d.viewInternals=t.link(),d.viewName&&!d.view.viewName&&(d.view.viewName=d.viewName)):a.warn("["+e.getStack()+"]","This is not a view!",t),d.hasView=!0,d.resolve()}),(function(t){t.msg=t.message,a.error("["+e.getStack()+"]","CAV view "+d.viewName+" failed to resolve:",t),e.page.emit("page:error",{code:"blue:cav:error:viewResolutionFailed",description:"CAV view "+d.viewName+" failed to resolve:"+t.name+":"+t.message}),d.reject(e,t)}))})),s++},c.prototype.isReady=function(){return this.hasComponent&&this.hasView},t.call(c.prototype,(function(){return"ComponentAndView"})),c})),define("blue-view/load",["require","blue/is","blue/resolver/module"],(function(e){"use strict";var t=e("blue/is"),n=new(e("blue/resolver/module"));return n.prefix="wire!",n.suffix="/pageConfig",function(e,i,r){if(!t.string(e))throw new TypeError("name must be a string");if(!t.function(i))throw new TypeError("callback must be a function");n.resolve(e).onValue((function(e){i.call(r,e)}))}})),define("blue-view/nodeDictionary",["require","blue/dom","blue/is","blue/store/weakMemory","blue/as/serializable","blue/log"],(function(e){"use strict";var t=e("blue/dom"),n=e("blue/is"),i=e("blue/store/weakMemory"),r=e("blue/as/serializable"),o=new(e("blue/log"))("[nodeDictionary]"),a=function(e){var i=n.array(e)?e[0]:e;return n.string(i)?t.querySelector(i):i};function u(){this.store=new i("node")}return u.prototype.hasViewAt=function(e){var n=t.querySelectorAll(e),i=n[0];return 1===n.length?this.store.has(i):(n.length,!1)},u.prototype.getViewAt=function(e){var n,i=t.querySelectorAll(e),r=i[0];if(1===i.length&&this.store.has(r))return n=1===(n=this.store.get(r)).length?n[0]:n},u.prototype.add=function(e,t){var n,i,r,u=a(e);if(!u)throw i=t.name.split(t.viewName)[0].slice(0,-1),t._componentStack&&(r=t._componentStack),o.warn('Could not create view in node "'+e+'". Node not found in DOM.'),t._destroy(),r?new Error('Could not create-view in controller "'+i+'" for component "'+r+'" in node "'+e.selector+'". Node not found in DOM.'):new Error('Could not create-view in controller "'+i+'" in node "'+e.selector+'". Node not found in DOM.');u.setAttribute("data-has-view","true"),(n=this.store.get(u)||[]).push(t),this.store.set(u,n)},u.prototype.destroy=function(e){var t=this,n=[],i=a(e);return i?((t.store.get(i)||[]).forEach((function(e){n.push(t.destroyView(e))})),Promise.all(n).then((function(){i.removeAttribute("data-has-view"),t.store.remove(i)}))):Promise.resolve()},u.prototype.destroyView=function(e){var t,n,i,r,a,u,s=this,c=e.viewName||"(unknown)",l=[],d=new Promise((function(e,t){r=e,a=t})),p=e.target?e.target:null,m=function(t){return t!==e};return e.element&&p&&s.store.has(p)&&s.store.get(p).indexOf(e)>-1?(n=function(e){var t;return e?(t=Array.from(e.querySelectorAll("[data-has-view]")),e.getAttribute("data-has-view")&&t.push(e),t):[]}(e.element),"function"==typeof(u=Array.from(n).map((function(e){var t=[];return e&&s.store.has(e)&&(s.store.get(e).forEach((function(e){t.push((function(){return e._destroy()}))})),e.removeAttribute("data-has-view"),s.store.remove(e)),function(){return Promise.all(t.map((function(e){return e()})))}})).reduceRight((function(e,t){return t?e.then(t()).catch((function(e){throw e})):e}),Promise.resolve()))&&(u=u()),u.then((function(){p?(t=s.store.get(p))&&(1===t.length&&t[0]===e?(l.push(e._destroy()),p.removeAttribute("data-has-view"),s.store.remove(p)):t.length>1&&(i=t.filter(m),l.push(e._destroy()),s.store.set(p,i))):l.push(e._destroy()),Promise.all(l).then((function(){r()})).catch((function(e){o.error("Error encountered when destroying a top-level view "+c,e),a(e)}))})).catch((function(e){throw o.error("Error encountered when destroying a nested view within "+c,e),e}))):(p?(t=s.store.get(p))&&(1===t.length&&t[0]===e?(l.push(e._destroy()),p.removeAttribute("data-has-view"),s.store.remove(p)):t.length>1&&(i=t.filter(m),l.push(e._destroy()),s.store.set(p,i))):l.push(e._destroy()),Promise.all(l).then((function(){r()})).catch((function(e){o.error("Error encountered when destroying a top-level view "+c,e),a(e)}))),d},r.call(u.prototype,(function(){return"NodeDictionary"})),new u})),define("blue-view/page/web",["require","blue/as/contextual","blue/as/registry","blue/util","../resolver/cav","blue/deferred","blue/dom","blue/event/channel","blue/log","blue/is","../load","../nodeDictionary","blue/queue","blue/resolver/module","blue/root","blue/siteData","emitter-js"],(function(t){"use strict";var n,i=t("blue/as/contextual"),r=t("blue/as/registry"),o=t("blue/util").object.deepClone,a=t("../resolver/cav"),u=t("blue/deferred"),s=t("blue/dom"),c=t("blue/event/channel"),l=t("blue/log"),d=t("blue/is"),p=t("../load"),m=t("../nodeDictionary"),v=t("blue/queue"),f=t("blue/resolver/module"),h=t("blue/root"),g=t("blue/siteData"),b=t("emitter-js").default,w=l("[blue:view]"),y=h.performance&&h.performance.now&&h.performance.mark,x={},C={ractive:{path:"blue-view-ractive/view",deferred:void 0},vue:{path:"blue-view-vue/view",deferred:void 0}},A="ractive",V={},k=function(e,t,i){var r,o,a={alert:"once",when:"visible",percent:50,duration:0,event:"blue:dom:visibility",handler:function(){}},u=function(e,t){var n=t?">"+t:"",i=e,r=0;if(e.id)return"#"+e.id+n;if(!e.parentNode)return e.tagName+n;if((e.nextSibling||e.previousSibling||{}).tagName===e.tagName){for(;i=i.previousSibling;)r++;return u(e.parentNode,e.tagName+":nth-child("+r+")"+n)}return u(e.parentNode,e.tagName+n)},c=function(e,t,i){var r=n.context;e&&e.removeAttribute("trackVisibility"),r&&w.error("["+r.getStack()+"]",i+" ["+t.data+"]")},l=function(e){switch(e.when){case"visible":return e.isVisible;case"hidden":return!e.isVisible}return!0},d=function(e,t){var r,o,a=function(e,t){var n=e.getAttribute("trackVisibility")||'{"default": true}';try{n=JSON.parse(n)}catch(t){c(e,{data:e.id},"Unable to parse trackVisibility value"),n={}}return{alert:n.alert||t.alert,when:n.when||t.when,percent:Math.max(1,Math.min(100,n.percent||t.percent)),duration:Math.max(n.duration||t.duration),event:n.event||t.event,isVisible:n.isVisible||!1,selector:n.selector||u(e),data:n.data}}(e,n);if(!t||!V[a.selector]){if(r=a.isVisible,o=function(e){var t,n,i=e.getBoundingClientRect(),r=Math.ceil(.1*(i.bottom-i.top)),o=Math.ceil(.1*(i.right-i.left)),a=window.innerWidth||document.documentElement.clientWidth,u=window.innerHeight||document.documentElement.clientHeight,s=function(t,n){return e.contains(document.elementFromPoint(t,n))};return i.top>u||i.left>a||i.right<0||i.bottom<0||!(s(Math.max(i.left+o,0),Math.max(i.top+r,0))||s(Math.min(i.right-o,a),Math.max(i.top+r,0))||s(Math.max(i.left+o,0),Math.min(i.bottom-r,u))||s(Math.min(i.right-o,a),Math.min(i.bottom-r,u)))?0:(t=(i.bottom-i.top)*(i.right-i.left),n=(Math.min(i.bottom,u)-Math.max(i.top,0))*(Math.min(i.right,a)-Math.max(i.left,0)),Math.round(n/t*100))}(e),a.isVisible=o>=a.percent,a.duration&&a.isVisible){if(!r)return a.isVisible=Date.now()+a.duration,e.setAttribute("trackVisibility",JSON.stringify(a)),setTimeout((function(){d(e,t)}),a.duration);if(r.constructor===Number&&r>Date.now())return}switch(a.alert){case"once":if(!l(a))return;t&&(V[a.selector]=!0),e.removeAttribute("trackVisibility");break;case"every":if(a.isVisible===r)return;if(e.setAttribute("trackVisibility",JSON.stringify(a)),!l(a)||!a.isVisible&&r.constructor===Number)return;break;default:return void c(e,a,"Invalid trackVisibility alert attribute")}!function(e,t,r){var o,a=(i.context||{}).children||[],u=a.length,s={selector:t.selector,isVisibile:t.isVisible,data:t.data};if(r)try{n.handler(s)}catch(n){c(e,t,n.message)}if(!t.default)for(;u--;)if((o=a[u].element)&&o.contains(e))return a[u].emit(t.event,s)}(e,a,t)}},p=function(e){e?(h.addEventListener("resize",v,!1),h.addEventListener("scroll",v,!1)):(h.removeEventListener("resize",v,!1),h.removeEventListener("scroll",v,!1)),o=e},m=function(e,t){for(var n,i=document.querySelectorAll(e),r=n=i.length;r--;)d(i[r],t);return n},v=function(){r||(r=setTimeout((function(){var e,t=Date.now(),i=(n.selector?m(n.selector,!0):0)+m("[trackVisibility]");!i&&o&&p(!1),i&&!o&&p(!0),r=void 0,(e=Date.now()-t)>50&&n.context&&w.warn("["+n.context.getStack()+"]","Visibility tracking took "+e+"ms to check "+i+" elements!")}),250))};i.constructor!==Object&&(i={}),Object.keys(a).forEach((function(e){e in i||(i[e]=a[e])})),i.context=e,n||(h.MutationObserver?new h.MutationObserver(v).observe(s,{childList:!0,subtree:!0}):h.addEventListener("DOMNodeInserted",v,!1)),n=i,v()},S=function(e,t,n){var i,r,o,a=Object.create(null),u=!0;function s(e){if(d.defined(e)&&d.plainObject(e)&&e&&d.defined(e.actions)&&d.plainObject(e.actions)&&e.actions)for(o in e.actions)a[o]=e.actions[o]}if(n.length){if(i=t[e.spec.name],d.defined(i)&&d.plainObject(i)&&i)for(r=0;r<n.length;r++)s(i[n[r]])}else s(e.spec);for(o in e.spec.actions)u=u&&a[o];return u&&(a[e.spec.name]=!0),a},I=function(e,t){var n=t[0]&&t[0].context&&t[0].context.viewEngine?t[0].context.viewEngine:e;return t[1]&&t[1].viewEngine&&(n=t[1].viewEngine),t[2]&&t[2].viewEngine&&(n=t[2].viewEngine),n},E=function(e,t,n){var i=t.link(),r=e.spec||{};return(n=n||{}).linkToPage=!0,i.bridge.addComponentSpecData(Object.keys(r.data||{}).reduce((function(e,t){return e[t]=1,e}),{})),i.bridge.addComponentSpecSettings(e.getSettingsValues()),i.bridge.addComponentSpecActions(e.getActionNames()),n.viewInternals=i,{resolved:Promise.resolve([e,t,n])}},T=function(e){var t=e.destroy;e.destroy=function(n){return n?t.call(e):Promise.reject(new Error("Warning: Page view's component was told to destroy. This component may not be destroyed."))}},L=function(e,t){var n=this;n.name=e,b(n),n.defineContext(t,{name:e,pageName:e,logger:l("[Page-"+e+"]"),viewResolver:new f,screen:Object.create(null,{hasViewAt:{value:m.hasViewAt.bind(m),enumerable:!0},getViewAt:{value:m.getViewAt.bind(m),enumerable:!0}}),env:Object.create(t.env||null),pageReady:new Promise((function(e){"loading"===s.readyState?s.addEventListener("DOMContentLoaded",e):e()}))}),Object.defineProperties(n.context.site.env,{onLine:{get:function(){return h.navigator.onLine},enumerable:!0},print:{value:function(){h.print()},enumerable:!0}}),Object.defineProperties(n.context.env,{scrollToTop:{value:function(e){e?(e.scrollTop=0,e.scrollLeft=0):h.scrollTo(0,0)},enumerable:!0}}),n.tellApp=void 0,n.context.getViewRegistry=function(e){return new Promise((function(t,n){C[e]?C[e].deferred.promise.then((function(){t(C[e].registry)})):n()}))},n.context.on("application:display",(function(e){var t,i=[],r=e.contextStack,u=e.resolverPathOptions||o(n.context.viewResolverOptions)||{};!e.resolverPathOptions&&e.areaName&&(u.prefix=u.prefix||"",u.prefix=u.prefix+e.areaName+"/"),e.viewEngine||(e.viewEngine=A),d.array(e.cavList)?d.array(e.cavList[0])||d.plainObject(e.cavList[0])?e.cavList.forEach((function(o){"PAGE"===o[1]&&o[0]?(T(o[0]),i.push(E(o[0],n.pageView,o[2]))):(t=I(e.viewEngine,o),n.loadViewEngine(t),i.push(new a(n.context,t,x,o,r,u)))}),n):"PAGE"===e.cavList[1]&&e.cavList[0]?(T(e.cavList[0]),i.push(E(e.cavList[0],n.pageView,e.cavList[2]))):(t=I(e.viewEngine,e.cavList),n.loadViewEngine(t),i.push(new a(n.context,t,x,e.cavList,r,u))):d.plainObject(e.cavList)&&i.push(new a(n.context,e.viewEngine,x,e.cavList,r,u)),i.length||(n.context.emit("blue:route:viewRenderComplete",{msgType:"blue:route:viewRenderComplete",id:e.routeId,displayReqId:e.displayReqId,contextPath:e.contextStack,cavList:"",timestamp:y?performance.now():0,name:"blue:route:viewRenderComplete view "+e.contextStack+" "+e.displayReqId}),e.resolve&&e.resolve()),n.insertComponentView(e.controllerAction,i,e.activityChannel).then((function(t){n.context.emit("blue:route:viewRenderComplete",{msgType:"blue:route:viewRenderComplete",id:e.routeId,displayReqId:e.displayReqId,contextPath:e.contextStack,cavList:t,timestamp:y?performance.now():0,name:"blue:route:viewRenderComplete view "+e.contextStack+" "+e.displayReqId}),e.resolve&&e.resolve()}),(function(t){n.context.emit("blue:route:viewRenderComplete",{msgType:"blue:route:viewRenderComplete",id:e.routeId,displayReqId:e.displayReqId,contextPath:e.contextStack,cavList:"",timestamp:y?performance.now():0,name:"blue:route:viewRenderComplete view "+e.contextStack+" "+e.displayReqId}),e.reject&&e.reject(t)}))})),n.context.on("application:ready",(function(){n.context.on("page:error",(function(e){n.tellApp("page:error",e)})),n.context.on("blue:route:viewRenderComplete",(function(e){n.tellApp(e.msgType,e)}))})),n.context.on("importer:registerView",(function(e){var t=e.contextStack+"/"+e.viewName;x[t]=e.viewPath})),this.constructorLegacyCallback.call(this)};function N(e,t){return(e&&e.context?e.context.getStack():"")+"+"+(t?t.name:"")}return L.prototype=Object.create(b.prototype),L.prototype.constructor=L,L.prototype.constructorLegacyCallback=function(){},L.prototype.destroy=function(){n=void 0,d.function(this.onDestroy)&&this.onDestroy(),b.prototype.destroy.call(this),this.destroyContext()},L.prototype.loadViewEngine=function(e){var t=this;e&&C[e]&&(C[e].deferred||(C[e].deferred=new u,h.requirejs([C[e].path],(function(n){C[e].deferred.resolve(n),r.call(C[e],"view",n,{lazy:!0,noCache:!0}),C[e].defineViewsRegistry(t.context)}),(function(e){context.error(e)}))))},L.prototype.insertComponentView=function(t,n,i){var r,a,u,l,p,f,h=this,g=[];return a=n.map((function(e){if(e)return e.resolved})),r=Promise.all(a),u=a.length,l=new Promise((function(e,t){p=e,f=t})),r.then((function(n){var r=new v("sync");n.forEach((function(n,a){r.add((function(r){var l,v,b,y,x,C,A=n[0],V=n[1],k=n[2],I=A&&A.context||{},E={},T=function(){var e,t,n;A?A.destroyed?setTimeout((function(){m.destroyView(V)}),0):(A._("enabled")&&A.disable(),k.viewInternals.bridge.enable(A.output),!A.__used&&i&&(A.__used=!0,e=A.output.asEventStream(),t=i.plug(e),e.onEnd(t)),A.enable(k.viewInternals.bridge.output)):(n=new c({eventTarget:k.viewInternals.bridge}),k.viewInternals.bridge.queueOutput=!0,k.viewInternals.bridge.enable(n)),r(),g.push(N(A,V)),a+1>=u&&p(g.join(","))};if(A&&A.destroyed)return r(),g.push(N(A,V)),void(a+1>=u&&p(g.join(",")));if(V&&V.destroyed)return r(),g.push(N(A,V)),void(a+1>=u&&p(g.join(",")));if(k.target?l=k.target:I.viewTargeter&&(l=I.viewTargeter.targetRequest(t,V.viewName)),l&&A&&!A._("keepAlive")&&function(e,t){var n,i,r,o=e.context.parent.getStack(),a=e.key,u=t||s;return d.string(t)&&(u=s.querySelector(t)),n=u&&u.querySelectorAll("[data-component-name]")||[],Array.prototype.some.call(n,(function(e){return i=e.getAttribute("data-component-name"),(r=i.split("|"))[0]===o&&r[1]===a}))}(A,l)){var L=`CAV render error: In controller ${A.context.parent.getStack()} the compoonent "${A.key}" cannot be bound to a view within "${l}" because doing so would cause the component to destroy and the view will fail. To avoid this issue, you can use "thisController.components.componentName.activeViewName". The value of this property equals the name of the active view currently bound to the component, or undefined if the component is not bound to an active view.`,M=`CAV render error: In controller ${A.context.parent.getStack()} the compoonent "${A.key}" cannot be bound to another view on the page because a component can only be bound to one active view at a time. To avoid this issue, you can use "thisController.components.componentName.activeViewName". The value of this property equals the name of the active view currently bound to the component, or undefined if the component is not bound to an active view.`,R=k.append?M:L;A.context.parent.logger.error(R)}k.linkToPage?(V.model.roles=S(A,h.roledata,h.userType),A._queueData=!0,y=A.spec||{},x=Object.keys(y.data||{}).reduce((function(e,t){return e[t]=1,e}),{}),C=V.rtemplate.get(),A.destroyed||(A._("enabled")&&A.disable(),Object.keys(C).forEach((function(e){x[e]&&A.model.set(e,C[e])})),k.viewInternals.bridge.reBind(A.output,x,A.getSettingsValues(),A.getActionNames()),!A.__used&&i&&(A.__used=!0,v=A.output.asEventStream(),b=i.plug(v),v.onEnd(b)),A.enable(k.viewInternals.bridge.output)),r(),a+1>=u&&p(g.join(","))):l?(d.plainObject(k.model)&&(V.model=h.context.util.object.mixIn(V.model,o(k.model))),A&&(Object.keys(A.spec.data||{}).forEach((function(e){E[e]=void 0})),V.model=h.context.util.object.mixIn(E,V.model,A.model.get({isolate:!0}),A.getSettingsValues()),V.model.roles=S(A,h.roledata,h.userType),A._queueData=!0),(k.append?Promise.resolve():m.destroy([l])).then((function(){k.append?V.appendTo(l,T):V.replaceIn(l,T)}),(function(e){throw w.error("["+h.context.getStack()+"]","View(s) in target node "+l+" failed to destroy",e),h.context.page.emit("page:error",{code:"blue:app:error:nodeDestroyFailed",description:"View(s) in target node "+l+" failed to destroy; "+e.name+":"+e.message}),e})).catch((function(e){var t=A?A.spec.name:"NONE",n=k.append?"appended":"rendered";w.error("["+h.context.getStack()+"]","CAV ("+t+":"+V.viewName+") could not be "+n+" to target "+l,e),h.context.page.emit("page:error",{code:k.append?"blue:app:error:cavAppendFailed":"blue:app:error:cavInsertFailed",description:"CAV ("+t+":"+V.viewName+") could not be "+n+" to target "+l+"; "+e.name+":"+e.message}),r(),a+1>=u&&f(e)}))):(w.error("["+h.context.getStack()+"]",V.viewName+" has no render target specified"),r(),a+1>=u&&f(e))}))}))}),(function(e){w.error("["+h.context.getStack()+"]","CAV List could not be resolved:",e),h.context.page.emit("page:error",{code:"blue:app:error:cavListResolutionFailed",description:"CAV List could not be resolved:"+e}),f(e)})),l},L.prototype.loadSpec=function(){var e,t,n,i,r=this,o=new Promise((function(n,i){e=n,t=i}));return p((n="",(i=(s.location.hash||"").replace("#","").split("/")).length&&i[0]?n=i[0]:h.appRoutes&&h.appRoutes[0]&&(n=h.appRoutes[0]),n),(function(n){r.settings=n,r.roledata=n.roles||Object.create(null),r.userType=[];var i=g.getData("userType");if(d.defined(i)&&i&&(d.string(i)||d.array(i))){var o=[],u=!0;d.string(i)&&(i=[i]);for(var s=0;s<i.length;s++)d.undefined(i[s])||!i[s]||"PrimaryUser"===i[s]?u=!1:o.push(i[s]);u&&(r.userType=o)}n.viewResolverOptions&&(r.context.viewResolverOptions=n.viewResolverOptions||{}),n.viewEngine?r.view&&r.loadViewEngine(n.viewEngine):(n.viewEngine=A,r.view&&r.loadViewEngine(A)),n.context&&Object.keys(n.context).forEach((function(e){r.context[e]=n.context[e]})),r.context.pageReady.then((function(){if(r.view){var i,o=r.viewTarget||"body";r.loadViewEngine(n.viewEngine),(i=new a(r.context,n.viewEngine,x,[void 0,r.view,{target:o}],r.context.getStack())).resolved.then((function(e){r.pageView=e[1]})),r.trackVisibility&&i.resolved.then((function(){k(r.context,0,r.trackVisibility)})),r.insertComponentView("page.root",[i]).then(e,t)}else e()}))})),o},L=i.call(L,{name:"page"})})),define("blue-view/mvc/mapper/mapping",["require","blue/is","blue/declare"],(function(e){"use strict";var t=e("blue/is");return e("blue/declare")({constructor:function(e){if(this.mapping=e,t.undefined(this.mapping))throw new TypeError('"mapping" is undefined')},lookup:function(){if(t.function(this.mapping.lookup))return this.mapping.lookup.apply(this.mapping,arguments);throw new TypeError('"mapping.lookup()" is not a function')},toString:function(){return" Mapping "}})})),define("blue-view/mvc/mapper",["require","blue/is","./mapper/mapping","blue/compose","blue/util","blue/intercept","blue/declare"],(function(e){"use strict";var t=e("blue/is"),n=e("./mapper/mapping"),i=e("blue/compose"),r=e("blue/util").string.trim,o=e("blue/intercept"),a=e("blue/declare"),u=function(e){return new n(e)};return a((function(){var e={constructor:function(){var e,t,n;if(arguments.length){for(e=[this],t=0;t<arguments.length;t++)e.push(arguments[t]);i.apply(i,e)}Object.defineProperty(this,"mappings",{get:function(){return n},set:function(e){n=e.map(u)},enumerable:!0}),this.defineInterceptors()},destroy:function(){this.destroyInterceptors()},mapRequest:function(){var e,n=arguments,i=!1;return this.mappings&&this.mappings.length&&this.mappings.some((function(o){return e=o.lookup.apply(o,n),t.defined(e)&&(e=e.split(",").map(r),i=e.length>0),i}),this),e},toString:function(){return" Mapper "}};return o.withInterceptors.call(e,"mapRequest"),e}))})),define("blue-view/mvc/targeter",["require","./mapper","blue/declare"],(function(e){"use strict";var t=e("./mapper");return e("blue/declare")(t,{constructor:function(){t.call(this)},targetRequest:function(e,t){return this.mapRequest(e,t)},toString:function(){return" Targeter "}})})),define("blue-view/with/domManagement",["require","blue/dom","blue/is"],(function(e){"use strict";e("blue/dom");var t=e("blue/is");return function(){var e=function(e,t){return e?t?Array.from(e.querySelectorAll(t)):[e]:[]};this.domManager={addClass:function(n,i,r){t.undefined(r)&&(r=i,i=void 0),r&&e(n.element,i).forEach((function(e){e.classList.add(r)}))},after:function(n,i,r){var o,a;t.undefined(r)&&(r=i,i=void 0),void 0!==r&&1===(o=e(n.element,i)).length&&(a=i?"afterend":"beforeend",t.string(r)?o[0].insertAdjacentHTML(a,r):r instanceof Element&&o[0].insertAdjacentElement(a,r))},empty:function(t,n){var i=e(t.element,n);if(1===i.length)for(;i[0].firstChild;)i[0].removeChild(i[0].firstChild)},hasClass:function(n,i,r){var o;return t.undefined(r)&&(r=i,i=void 0),!!r&&(1===(o=e(n.element,i)).length&&o[0].classList.contains(r))},hide:function(t,n){e(t.element,n).forEach((function(e){e.style.display&&e.setAttribute("data-display-reset",e.style.display),e.style.display="none"}))},html:function(n,i,r){var o;t.undefined(r)&&(r=i,i=void 0),void 0!==r&&1===(o=e(n.element,i)).length&&(t.string(r)?o[0].innerHTML=r:r instanceof Element&&(n.empty(i),o[0].appendChild(r)))},prepend:function(n,i,r){var o,a;t.undefined(r)&&(r=i,i=void 0),void 0!==r&&1===(o=e(n.element,i)).length&&(a=i?"beforebegin":"afterbegin",t.string(r)?o[0].insertAdjacentHTML(a,r):r instanceof Element&&o[0].insertAdjacentElement(a,r))},remove:function(t,n){var i=e(t.element,n);1===i.length&&i[0].remove()},removeClass:function(n,i,r){t.undefined(r)&&(r=i,i=void 0),n.element&&r&&e(n.element,i).forEach((function(e){e.classList.remove(r)}))},replace:function(e){e.context.logger.warn("view.replace is no longer supported")},show:function(t,n){e(t.element,n).forEach((function(e){e.style.display=e.getAttribute("data-display-reset")||"",e.removeAttribute("data-display-reset")}))}},Object.keys(this.domManager).forEach((function(e){this[e]=this.domManager[e].bind(this,this)}),this)}})),define("blue-view/main",(function(){}));